## 事务定义
事务处理是一种机制，用来管理必须成批执行的 SQL 操作，保证数据库不包含不完整的操作结果。

## 四个原则

	1. 原子性：事务要么全部执行要么全部不执行
	
	2. 一致性：针对一个事务操作前后状态一致
	
	3. 隔离性：事务一旦提交则状态不可逆
	
	4. 持久性：两个事务的操作不会相互影响



## 事务的隔离级别

```
1. 脏读：一个事务读取了另外一个事务没有提交的数据

2. 幻读（虚读）：事务读取了其他事务更改的数据，导致前后读取的数据不一致

3. 不可重复读：一个事务读取同一数据多次结果不一样
```



## 示例

```mysql
-- MySQL默认开启事务自动提交
SET autocommit = 0; -- close the autocommit
SET antocommit = 1; -- open the autocommit

-- 手动处理事务
SET autocommit = 0; -- 关闭自动提交

-- 事务开启
START TRANSACTION; -- 标记一个事务的开始，从这之后的SQL都在同一个事务内


-- 提交：持久化
COMMIT;

-- 回滚：回到原来的样子
ROLLBACK;

-- 事务结束
SET autocommit = 1;  -- 开启事务自动提交,开启后操作不可回退

SAVEPOINT name; -- 事务的保存点名称
ROLLBACK TO SAVEPOINT name; -- 回滚到保存点
RELEASE SAVEPOINT name; -- 删除保存点

-- show the state of autocommit
show session variables like 'autocommit';
```





```mysql
CREATE TABLE transfer ( -- create a table 
    `id` INT(5) NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(20) NOT NULL,
    `money` DECIMAL(8 , 2 ) NOT NULL,
    PRIMARY KEY (`id`)
)  ENGINE=INNODB DEFAULT CHARSET=utf8mb4;

-- insert the values 
INSERT INTO transfer ( `name`, `money`) VALUES ('eagle', '2000.00'),('tiger','10000.00');

-- transfer transaction

-- close autocommit
SET autocommit = 0;

-- START transaction
START TRANSACTION;-- open a transaction

UPDATE transfer 
SET 
    money = money - 500
WHERE
    id = 1;
    
UPDATE transfer 
SET 
    money = money + 500
WHERE
    id = 2;

-- COMMIT transaciton IF success  
COMMIT; -- once the THRANSACTION is committed, the data persistence is finished

-- ROLLBACK transaction IF fail
ROLLBACK;

-- CLOSE autocommit
SET autocommit = 1;

-- show the table
SELECT * FROM business.transfer;

-- show the state of autocommit
show session variables like 'autocommit';

-- drop the table
DROP TABLE transfer;
```





